---
- name: Ensure bigbluebutton group has fixed gid
  become: true
  ansible.builtin.group:
    name: bigbluebutton
    system: true
    gid: "{{ bbb_group_gid }}"

- name: Ensure bigbluebutton user has fixed uid
  become: true
  ansible.builtin.user:
    name: bigbluebutton
    system: true
    shell: /bin/false
    home: /home/bigbluebutton
    uid: "{{ bbb_user_uid }}"
    groups: [bigbluebutton]
    append: true

- name: Install BBB packages
  become: true
  ansible.builtin.package:
    name: "{{ item.name }}"
    state: "{{ 'present' if item.when | default(True) else 'absent' }}"
  loop: "{{ bbb_packages }}"
  loop_control:
    label: "{{ item.name | join(',') }}"
